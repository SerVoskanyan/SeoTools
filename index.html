<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO-Анализатор для GitHub Pages</title>
    <meta name="description" content="Легкий инструмент для SEO-анализа и аудита, разработанный для развертывания на GitHub Pages.">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: "Inter", sans-serif;
        }
        /* Custom styles that aren't in Tailwind */
        .loading-spinner {
            border-top-color: #3498db;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center p-4 min-h-screen">

<div class="container max-w-4xl w-full bg-white rounded-xl shadow-lg p-6 sm:p-10 border border-gray-200">
    <header class="mb-6 text-center">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-800 mb-2">SEO-Анализатор</h1>
        <p class="text-gray-600 text-sm sm:text-base">Введите URL-адрес сайта для анализа его технических SEO-параметров. Нажмите кнопку "Анализировать", чтобы начать.</p>
    </header>

    <form id="url-form" class="flex flex-col sm:flex-row gap-4 mb-6">
        <input type="url" id="url-input" placeholder="Введите URL-адрес сайта (например, https://example.com)" required
               class="flex-grow p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        <button type="submit" id="analyze-button"
                class="bg-blue-600 text-white font-semibold py-3 px-6 rounded-md shadow-md hover:bg-blue-700 transition-colors duration-300 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2">
            Анализировать
            <div id="loading-spinner" class="loading-spinner hidden border-4 border-gray-200 border-t-blue-500 rounded-full w-5 h-5"></div>
        </button>
    </form>

    <main id="results-container" class="space-y-6">
        <!-- Results will be injected here -->
    </main>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('url-form');
        const urlInput = document.getElementById('url-input');
        const analyzeButton = document.getElementById('analyze-button');
        const spinner = document.getElementById('loading-spinner');
        const resultsContainer = document.getElementById('results-container');

        form.addEventListener('submit', async function(event) {
            event.preventDefault();

            const url = urlInput.value;

            // Clear previous results and show spinner
            resultsContainer.innerHTML = '';
            analyzeButton.disabled = true;
            spinner.classList.remove('hidden');

            try {
                const pageHtml = await fetchUrl(url);
                if (pageHtml) {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(pageHtml, 'text/html');

                    const reportHtml = generateSeoReport(doc, url);
                    resultsContainer.innerHTML = reportHtml;

                    // Execute a second pass to fetch robots.txt and sitemap.xml asynchronously
                    checkRobotsAndSitemap(url);
                } else {
                    resultsContainer.innerHTML = `<div class="p-4 bg-red-100 border border-red-400 text-red-700 rounded-md">
                        <p><strong>Не удалось получить доступ к сайту.</strong> Возможно, сайт не разрешает запросы извне (политика CORS), что мешает инструменту работать. Это ограничение не зависит от нас.</p>
                    </div>`;
                }
            } catch (error) {
                console.error('Ошибка анализа:', error);
                resultsContainer.innerHTML = `<div class="p-4 bg-red-100 border border-red-400 text-red-700 rounded-md">
                    <p><strong>Произошла ошибка при анализе сайта.</strong> Пожалуйста, попробуйте еще раз.</p>
                </div>`;
            } finally {
                analyzeButton.disabled = false;
                spinner.classList.add('hidden');
            }
        });

        async function fetchUrl(url) {
            try {
                // Using a proxy to bypass CORS
                const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
                const data = await response.json();
                return data.contents;
            } catch (error) {
                console.error("Ошибка при получении URL:", error);
                return null;
            }
        }

        function generateSeoReport(doc, url) {
            return `
                <div class="report-section space-y-4">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 border-b-2 pb-2">Сводка по анализу сайта</h2>
                    <div class="p-4 bg-blue-100 border border-blue-400 text-blue-800 rounded-md">
                        <p><strong>Анализируемый URL:</strong> <a href="${url}" target="_blank" class="text-blue-600 hover:underline">${url}</a></p>
                        <p><strong>Дата анализа:</strong> ${new Date().toLocaleString('ru-RU')}</p>
                    </div>
                </div>
                
                <div class="report-section space-y-4">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 border-b-2 pb-2">Анализ заголовков (h1-h6)</h2>
                    ${analyzeHeadings(doc)}
                </div>

                <div class="report-section space-y-4">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 border-b-2 pb-2">Анализ метатегов</h2>
                    ${analyzeMetaTags(doc)}
                </div>

                <div class="report-section space-y-4">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 border-b-2 pb-2">Проверка файлов robots.txt и sitemap.xml</h2>
                    <p class="text-gray-500"><strong>Внимание:</strong> для этих проверок требуется включенный CORS на целевом сайте.</p>
                    <div id="robots-status" class="p-4 bg-yellow-100 border border-yellow-400 text-yellow-800 rounded-md">Проверка robots.txt...</div>
                    <div id="sitemap-status" class="p-4 bg-yellow-100 border border-yellow-400 text-yellow-800 rounded-md">Проверка sitemap.xml...</div>
                </div>
            `;
        }
        
        function analyzeHeadings(doc) {
            const headings = doc.querySelectorAll('h1, h2, h3, h4, h5, h6');
            const h1Count = doc.querySelectorAll('h1').length;
            let html = '';

            if (h1Count === 0) {
                html += `<div class="p-4 bg-red-100 border border-red-400 text-red-700 rounded-md">
                    <p>❌ <strong>Критическая ошибка:</strong> Отсутствует тег <code>&lt;h1&gt;</code>. Это основной заголовок, который должен точно отражать тему страницы. <br><strong>Рекомендация:</strong> Добавьте один уникальный <code>&lt;h1&gt;</code> на страницу.</p>
                </div>`;
            } else if (h1Count > 1) {
                html += `<div class="p-4 bg-red-100 border border-red-400 text-red-700 rounded-md">
                    <p>❌ <strong>Критическая ошибка:</strong> Обнаружено ${h1Count} тегов <code>&lt;h1&gt;</code>. На странице должен быть только один <code>&lt;h1&gt;</code>.<br><strong>Рекомендация:</strong> Оставьте один основной заголовок, а остальные замените на <code>&lt;h2&gt;</code> или другие заголовки более низкого уровня.</p>
                </div>`;
            } else {
                html += `<div class="p-4 bg-green-100 border border-green-400 text-green-700 rounded-md">
                    <p>✅ <strong>Отлично:</strong> Найдено 1 тег <code>&lt;h1&gt;</code>.</p>
                </div>`;
            }

            const headingLevels = Array.from(headings).map(h => parseInt(h.tagName.substring(1)));
            let isHierarchical = true;
            for (let i = 0; i < headingLevels.length - 1; i++) {
                if (headingLevels[i+1] > headingLevels[i] + 1) {
                    isHierarchical = false;
                    break;
                }
            }

            if (!isHierarchical) {
                html += `<div class="p-4 bg-yellow-100 border border-yellow-400 text-yellow-800 rounded-md">
                    <p>⚠️ <strong>Внимание:</strong> Нарушена иерархия заголовков. Вы пропускаете уровни (например, после <code>&lt;h2&gt;</code> идет <code>&lt;h4&gt;</code>).<br><strong>Рекомендация:</strong> Используйте заголовки последовательно, от <code>&lt;h1&gt;</code> до <code>&lt;h6&gt;</code>.</p>
                </div>`;
            } else {
                html += `<div class="p-4 bg-green-100 border border-green-400 text-green-700 rounded-md">
                    <p>✅ <strong>Отлично:</strong> Иерархия заголовков соблюдается.</p>
                </div>`;
            }
            
            if (headings.length > 0) {
                const headingList = Array.from(headings).map(h => `<li class="ml-4 list-disc"><strong>${h.tagName}:</strong> ${h.textContent.trim()}</li>`).join('');
                html += `<h4 class="font-semibold text-gray-700 mt-4">Обнаруженные заголовки:</h4><ul class="text-sm text-gray-600">${headingList}</ul>`;
            } else {
                html += `<div class="p-4 bg-red-100 border border-red-400 text-red-700 rounded-md">
                    <p>❌ На странице не найдено ни одного заголовка <code>&lt;h1&gt;-&lt;h6&gt;</code>. Это ухудшает читаемость и понимание структуры сайта поисковыми системами.</p>
                </div>`;
            }
            return html;
        }

        function analyzeMetaTags(doc) {
            let html = '';

            const titleTag = doc.querySelector('title');
            if (titleTag && titleTag.textContent.length > 0) {
                html += `<div class="p-4 bg-green-100 border border-green-400 text-green-700 rounded-md">
                    <p>✅ <strong>Отлично:</strong> Тег <code>&lt;title&gt;</code> найден. <br><strong>Содержимое:</strong> "${titleTag.textContent.trim()}"</p>
                </div>`;
            } else {
                html += `<div class="p-4 bg-red-100 border border-red-400 text-red-700 rounded-md">
                    <p>❌ <strong>Критическая ошибка:</strong> Отсутствует или пустой тег <code>&lt;title&gt;</code>. Это самый важный элемент для поисковых систем.<br><strong>Рекомендация:</strong> Добавьте уникальный, содержательный заголовок длиной 50-60 символов.</p>
                </div>`;
            }

            const descriptionTag = doc.querySelector('meta[name="description"]');
            if (descriptionTag && descriptionTag.getAttribute('content') && descriptionTag.getAttribute('content').length > 0) {
                html += `<div class="p-4 bg-green-100 border border-green-400 text-green-700 rounded-md">
                    <p>✅ <strong>Отлично:</strong> Тег <code>&lt;meta name="description"&gt;</code> найден.<br><strong>Содержимое:</strong> "${descriptionTag.getAttribute('content').trim()}"</p>
                </div>`;
            } else {
                html += `<div class="p-4 bg-yellow-100 border border-yellow-400 text-yellow-800 rounded-md">
                    <p>⚠️ <strong>Внимание:</strong> Отсутствует или пустой тег <code>&lt;meta name="description"&gt;</code>.<br><strong>Рекомендация:</strong> Добавьте уникальное описание длиной до 160 символов, которое будет отображаться в результатах поиска.</p>
                </div>`;
            }

            const robotsTag = doc.querySelector('meta[name="robots"]');
            if (robotsTag && robotsTag.getAttribute('content') && robotsTag.getAttribute('content').includes('noindex')) {
                html += `<div class="p-4 bg-red-100 border border-red-400 text-red-700 rounded-md">
                    <p>❌ <strong>Предупреждение:</strong> Обнаружен тег <code>&lt;meta name="robots" content="noindex"&gt;</code>. Эта страница не будет индексироваться.<br><strong>Рекомендация:</strong> Убедитесь, что это сделано намеренно. Если нет, удалите этот тег.</p>
                </div>`;
            } else {
                html += `<div class="p-4 bg-green-100 border border-green-400 text-green-700 rounded-md">
                    <p>✅ <strong>Отлично:</strong> Не обнаружен тег <code>noindex</code> в мета-роботах.</p>
                </div>`;
            }

            const canonicalTag = doc.querySelector('link[rel="canonical"]');
            if (canonicalTag && canonicalTag.getAttribute('href') && canonicalTag.getAttribute('href').length > 0) {
                html += `<div class="p-4 bg-green-100 border border-green-400 text-green-700 rounded-md">
                    <p>✅ <strong>Отлично:</strong> Тег <code>&lt;link rel="canonical"&gt;</code> найден.<br><strong>URL:</strong> ${canonicalTag.getAttribute('href').trim()}</p>
                </div>`;
            } else {
                html += `<div class="p-4 bg-blue-100 border border-blue-400 text-blue-800 rounded-md">
                    <p>ℹ️ <strong>Информация:</strong> Тег <code>canonical</code> не найден. Это может привести к проблемам с дублированием контента, если страница доступна по нескольким URL.</p>
                </div>`;
            }
            return html;
        }

        async function checkRobotsAndSitemap(siteUrl) {
            const origin = new URL(siteUrl).origin;
            const robotsUrl = `${origin}/robots.txt`;
            const sitemapUrl = `${origin}/sitemap.xml`;
            
            const robotsStatusDiv = document.getElementById('robots-status');
            const sitemapStatusDiv = document.getElementById('sitemap-status');

            // Check robots.txt
            try {
                const response = await fetch(robotsUrl, { method: 'HEAD' }); // Use HEAD to be efficient
                if (response.ok) {
                    robotsStatusDiv.className = 'p-4 bg-green-100 border border-green-400 text-green-700 rounded-md';
                    robotsStatusDiv.innerHTML = `<p>✅ <strong>Найден:</strong> Файл <code>robots.txt</code> доступен. (Прокси-сервис не может показать содержимое, но наличие подтверждено.)</p>`;
                } else {
                    robotsStatusDiv.className = 'p-4 bg-red-100 border border-red-400 text-red-700 rounded-md';
                    robotsStatusDiv.innerHTML = `<p>❌ <strong>Не найден:</strong> Файл <code>robots.txt</code> не доступен (${response.status} ${response.statusText}).</p>`;
                }
            } catch (error) {
                 robotsStatusDiv.className = 'p-4 bg-red-100 border border-red-400 text-red-700 rounded-md';
                 robotsStatusDiv.innerHTML = `<p>❌ <strong>Ошибка:</strong> Не удалось проверить <code>robots.txt</code>. Возможно, из-за политики CORS или проблем с сетью.</p>`;
            }

            // Check sitemap.xml
            try {
                const response = await fetch(sitemapUrl, { method: 'HEAD' });
                if (response.ok) {
                    sitemapStatusDiv.className = 'p-4 bg-green-100 border border-green-400 text-green-700 rounded-md';
                    sitemapStatusDiv.innerHTML = `<p>✅ <strong>Найден:</strong> Файл <code>sitemap.xml</code> доступен. (Прокси-сервис не может показать содержимое, но наличие подтверждено.)</p>`;
                } else {
                    sitemapStatusDiv.className = 'p-4 bg-red-100 border border-red-400 text-red-700 rounded-md';
                    sitemapStatusDiv.innerHTML = `<p>❌ <strong>Не найден:</strong> Файл <code>sitemap.xml</code> не доступен (${response.status} ${response.statusText}).</p>`;
                }
            } catch (error) {
                sitemapStatusDiv.className = 'p-4 bg-red-100 border border-red-400 text-red-700 rounded-md';
                sitemapStatusDiv.innerHTML = `<p>❌ <strong>Ошибка:</strong> Не удалось проверить <code>sitemap.xml</code>. Возможно, из-за политики CORS или проблем с сетью.</p>`;
            }
        }
    });
</script>

</body>
</html>
